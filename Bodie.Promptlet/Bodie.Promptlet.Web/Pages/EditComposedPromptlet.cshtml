@page "id:int"
@using Bodie.Promptlet.Web.Pages
@model EditComposedPromptletModel
<link rel="stylesheet" href="../css/2-sort-list.css">
<script src="../js/3-sort-list.js"></script>
@section Scripts{
    <script>


        slist(document.getElementById("sortlist"));
   
        $('#sortlist').on(
    'drop',
    function(e){
        if(e.originalEvent.dataTransfer && e.originalEvent.dataTransfer.getData) {
            e.preventDefault();
            e.stopPropagation();
            
         //   alert($(this).val.toString());
        }
    }
);
  
    </script>
}

<div>
    <span  style="font-family: sans-serif; color:darkgray" class="h5">Composed Promptlet for @Model.ComposedPromptlet.ComposedPromptletName</span>

    <form method="post">
        <input asp-for="ComposedPromptlet.ComposedPromptletId" type="hidden" />
        <div class="container text-left">
            <div class="row">
                <div class="col">
                    <div class="row">
                        <div class="form-label col-md-10">
                           <h4> Name</h4>
                            @Html.EditorFor(model => model.ComposedPromptlet.ComposedPromptletName
                            , new { htmlAttributes = new { @class = "form-control" } })
                        </div>
                        <div class="form-label col-md-2">
                          <h4>Version</h4>  
                            @Html.EditorFor(model => model.ComposedPromptlet.ComposedPromptletVersion
                            , new { htmlAttributes = new { @class = "form-control" } })
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-label col-form-label row-cols-md-1">
                          <h4>Description</h4>  
                            @Html.TextAreaFor(model => model.ComposedPromptlet.ComposedPromptletDescription
                      , new { htmlAttributes = new { @class = "form-control" } })
                        </div>
                    </div>
                    <div class="row bg-light">
                        <div class="form-label col-form-label col">
                            <h4>Header</h4>
                            @Html.EditorFor(model => model.ComposedPromptlet.ComposedPromptletHeader
                                            , new { htmlAttributes = new { @class = "form-control" } })
                                         
                            <br />
                            
                            <h4>Artifacts<a asp-page="./AddPromptletArtifact" asp-route-id="@Model.ComposedPromptlet.ComposedPromptletId"  class="btn btn-outline-info btn-sm lh-1 p-sm-1">Add</a> 
                             </h4>
                            <div class="container bg-light bg-opacity-10 rounded box-shadow ">



                            <ul id="sortlist" >
                                @foreach (var item in Model.ComposedPromptlet.PromptletArtifacts.OrderBy(x=>x.PromptletArtifactOrder))
                                {
<li  >  
    @Html.HiddenFor(model=>model.ComposedPromptlet.PromptletArtifacts.FirstOrDefault(x=>x.PromptletArtifactId.Equals(item.PromptletArtifactId)).PromptletArtifactId)
     @Html.HiddenFor(model=>model.ComposedPromptlet.PromptletArtifacts.FirstOrDefault(x=>x.PromptletArtifactId.Equals(item.PromptletArtifactId)).PromptletArtifactOrder)
       @Html.HiddenFor(model=>model.ComposedPromptlet.PromptletArtifacts.FirstOrDefault(x=>x.PromptletArtifactId.Equals(item.PromptletArtifactId)).PromptletArtifactName)

                                  <div class="my-3 p-3 bg-dark bg-opacity-10  rounded box-shadow">
                                      <div class="row">     
                                      <div class="row">  
                                
                                                  <h6 class="border-bottom border-gray mb-0">
                                                      <div class="row align-bottom">
                                                <div class="col-sm-9">
                                                          <span data-idorder="@string.Concat(@item.PromptletArtifactId,",",@item.PromptletArtifactOrder)" style="color:teal" class="font-monospace h5">
                                                            @Html.DisplayFor(modelItem => item.PromptletArtifactOrder))
                                                            @Html.DisplayFor(modelItem => item.PromptletArtifactName)
                                                          </span>

                                                             </div>
                                                              <div class="col-sm-1">
                                                            <div class="btn-group btn-group-sm lh-1">
                                                                <a asp-page="./EditPromptletArtifact"
                                                                   class="btn btn-sm btn-outline-success lh-1"
                                                                   asp-route-id="@item.PromptletArtifactId">Edit</a>
                                                                <a asp-page="./EditComposedPromptlet"
                                                                   onclick="return confirm('Are you sure you want to delete this item?');"
                                                                   asp-page-handler="Delete"
                                                                   asp-route-id="@item.PromptletArtifactId"
                                                                   class="btn btn-sm btn-outline-danger lh-1">Delete</a>
                                                                   </div>
                                                            </div>
                                                            </div>
                                                            </h6>
                                                   
                                                 </div>
                                                 <div class="row border-bottom border-light">
                                                     <div class="col-1"></div>
                                                     <div class="col-11">
                                                   <span style="color:GrayText" class="media-body pb-1 mb-0 small  h-100 ">
                                                       <i>@Html.DisplayFor(modelItem => item.PromptletArtifactDescription)
                                                  </i>


                                                       </span>
                                                    </div>
                                                 </div>
                                                <div class="row">
                                                    <div class="media text-muted  mb-0">
                                                        @Html.DisplayFor(modelItem =>item.PromptletArtifactContent)
                                                    </div>
                                                </div>
                                      </div>
                            
                                  </div>

        </li>

                                }
                                </ul>
                                <div class="border-bottom border-gray p-2 ">
                       
                            </div>
                                <h4>Footer</h4>

                                @Html.EditorFor(model => model.ComposedPromptlet.ComposedPromptletFooter
                          , new { htmlAttributes = new { @class = "form-control col" } })

                            </div>

                        </div>

                    </div>

                </div>
                <div class="btn-group btn-group-sm">
               <input type="submit" value="Save" class="btn btn-success" />
                <a asp-page="./GeneratePrompt" asp-route-id="@Model.ComposedPromptlet.ComposedPromptletId"  class="btn btn-sm btn-outline-dark">Try it out</a> 

               <a class="btn btn-sm btn-outline-danger" href="/AllComposedPromptlet">Cancel</a>
        
                </div>
     </div>  </div>
                 </form>
               
    </div>
